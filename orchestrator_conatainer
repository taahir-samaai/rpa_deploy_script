cat > containers/orchestrator/Containerfile << 'EOF'
FROM python:3.11-slim

USER root

# Install system dependencies
RUN apt-get update && \
    apt-get install -y sqlite3 gcc curl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Create application user
RUN useradd -m -u 1001 rpauser && \
    mkdir -p /app && \
    chown -R rpauser:rpauser /app

USER rpauser
WORKDIR /app

# Install Python dependencies
COPY requirements.txt ./
RUN pip install --user --no-cache-dir -r requirements.txt

# Copy core application files for orchestrator
COPY --chown=rpauser:rpauser rpa_botfarm/orchestrator.py ./
COPY --chown=rpauser:rpauser rpa_botfarm/config.py ./
COPY --chown=rpauser:rpauser rpa_botfarm/auth.py ./
COPY --chown=rpauser:rpauser rpa_botfarm/db.py ./
COPY --chown=rpauser:rpauser rpa_botfarm/models.py ./
COPY --chown=rpauser:rpauser rpa_botfarm/errors.py ./
COPY --chown=rpauser:rpauser rpa_botfarm/health_reporter.py ./
COPY --chown=rpauser:rpauser rpa_botfarm/rate_limiter.py ./
COPY --chown=rpauser:rpauser rpa_botfarm/conjur_client.py ./

# Create required directories
RUN mkdir -p data/db data/logs data/screenshots data/evidence

EXPOSE 8620
HEALTHCHECK --interval=30s --timeout=10s --retries=3 \
    CMD curl -f http://localhost:8620/health || exit 1

CMD ["python", "orchestrator.py"]
EOF
